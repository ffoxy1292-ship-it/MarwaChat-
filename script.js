// ====================== ŸÇÿßÿπÿØÿ© ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ© ====================== 
const responses = { 
  ar: { 
    sadness: [
      "ÿ£ÿπÿ±ŸÅ ÿ¥ÿπŸàÿ±ŸÉÿå ŸÑŸÖÿß ÿ™ÿ≠ÿ≥ ÿ•ŸÜ ŸÉŸÑ ÿ¥Ÿäÿ° ÿ≠ŸàÿßŸÑŸäŸÉ ÿ´ŸÇŸäŸÑ ŸàŸÉÿ£ŸÜ ÿßŸÑÿØŸÜŸäÿß ÿµÿßÿ±ÿ™ ÿ∂ÿØŸÉ",
      "ÿßŸÑÿ≠ÿ≤ŸÜ ÿ£ŸàŸÇÿßÿ™ Ÿäÿ¨Ÿä ŸÅÿ¨ÿ£ÿ© ŸàŸäÿÆŸÑŸä ŸÉŸÑ ÿ¥Ÿä ÿ®ÿßŸáÿ™ÿå ŸàŸÉÿ£ŸÜ ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßÿÆÿ™ŸÅÿ™",
      "ÿ£ÿ≠ŸäÿßŸÜŸãÿß ŸÜÿ®ÿ∫Ÿâ ŸÜŸáÿ±ÿ® ŸÖŸÜ ÿßŸÑÿ≠ÿ≤ŸÜÿå ŸÜÿ∫ŸÑŸÇ ÿπŸäŸàŸÜŸÜÿß ŸàŸÜŸÇŸàŸÑ ÿ•ŸÜŸá ŸÖÿ¥ ŸÖŸàÿ¨ŸàÿØ",
      "ŸäŸÖŸÉŸÜ ÿØŸÖŸàÿπŸÉ ÿ™ÿ®ŸäŸÜŸÑŸÉ ÿ∂ÿπŸÅÿå ÿ®ÿ≥ ŸÅŸä ÿßŸÑÿ≠ŸÇŸäŸÇÿ© ŸÉŸÑ ÿØŸÖÿπÿ© ÿØŸÑŸäŸÑ ÿ•ŸÜŸÉ ÿ•ŸÜÿ≥ÿßŸÜ ŸàÿßÿπŸä",
      "Ÿàÿ¥ ÿßŸÑŸÉŸÑŸÖÿ© ÿßŸÑŸÑŸä ŸÉÿßŸÜ ŸàÿØŸÉ ÿ™ÿ≥ŸÖÿπŸáÿß ÿßŸÑŸäŸàŸÖÿü",
      "ŸÉÿßŸÜ ŸàÿØŸä ÿ£ŸÇÿØÿ± ÿ£ÿ¥ŸäŸÑ ÿπŸÜŸÉ ÿßŸÑŸÜÿµ",
      "ŸÖÿß ŸÅŸä ÿØÿßÿπŸä ÿ™ÿ¥ÿ±ÿ≠... ÿ£ŸÜÿß ÿßŸÅŸáŸÖ",
      "ÿÆŸÑŸäŸÜŸä ÿ£ÿ¥ÿßÿ±ŸÉŸÉ ÿßŸÑÿ´ŸÇŸÑ",
      "Ÿàÿ¥ ÿ£ŸÉÿ´ÿ± ÿ¥Ÿä ÿ∂ÿßÿ∫ÿ∑ ÿπŸÑŸäŸÉ ÿßŸÑÿ≠ŸäŸÜÿü",
      "ÿ™ÿ®ÿ∫Ÿâ ÿ£ÿ≠ŸÉŸä ŸÖÿπŸÉ ŸàŸÑÿß ÿ£ÿ≥ŸÖÿπ ÿ®ÿ≥ÿü"
    ], 
    happiness: [
      "ÿ≠ÿ≥Ÿäÿ™ ÿ®ŸÅÿ±ÿ≠ÿ© ŸÉÿ®Ÿäÿ±ÿ© ÿßŸÑŸäŸàŸÖ! ŸÉŸÑ ÿ¥Ÿäÿ° ÿ≠ŸàÿßŸÑŸäŸÜÿß ŸÉÿ£ŸÜŸà ŸÖÿ∂ŸàŸä",
      "ŸáŸáŸáŸá‚Ä¶ ŸÖÿß ÿ™ÿ™ÿÆŸäŸÑ ŸÇÿØ ÿ•Ÿäÿ¥ ÿ≠ÿ≥Ÿäÿ™ ÿ®ÿßŸÑÿ®Ÿáÿ¨ÿ© ŸÑŸÖÿß ÿ¥ÿßÿ±ŸÉÿ™ ŸÖÿπŸä ÿßŸÑŸäŸàŸÖ",
      "ŸÖŸÖ‚Ä¶ ÿ∂ÿ≠ŸÉÿ™ŸÉ ÿßŸÑŸäŸàŸÖ ŸÉÿßŸÜÿ™ ŸÖÿπÿØŸäÿ©! ŸÖÿß ŸÉŸÜÿ™ ŸÖÿ™ŸàŸÇÿπ ÿ•ŸÜŸáÿß ÿ™ÿ£ÿ´ÿ± ÿπŸÑŸä ÿ®ŸáÿßŸÑÿ∑ÿ±ŸäŸÇÿ©",
      "Ÿäÿß ÿ≥ŸÑÿßŸÖ‚Ä¶ ÿ¥ÿπŸàÿ± ÿßŸÑŸÅÿ±ÿ≠ ÿßŸÑŸÑŸä ÿ≠ÿ≥Ÿäÿ™ ŸÅŸäŸá ÿßŸÑŸäŸàŸÖ ŸäÿÆŸÑŸäŸÉ ÿ™ŸÅŸÉÿ± ÿ•ŸÜ ÿßŸÑÿØŸÜŸäÿß ŸÉŸÑŸáÿß ŸÖŸÖŸÉŸÜ ÿ™ŸÉŸàŸÜ ÿ¨ŸÖŸäŸÑÿ©",
      "ŸàÿßŸà! Ÿáÿ∞ÿß ÿ±ÿßÿ¶ÿπ ÿ¨ÿØÿßŸã!",
      "ŸÅÿ±ÿ≠ÿ™Ÿä ŸÑŸÅÿ±ÿ≠ŸÉ ŸÑÿß ÿ™ŸàÿµŸÅ!",
      "ŸÇŸÑÿ®Ÿä Ÿäÿ±ŸÇÿµ ŸÖŸÜ ÿßŸÑÿ≥ÿπÿßÿØÿ©!",
      "ÿ£ÿ¥ÿπÿ± ÿ®ÿ£ŸÜ ÿßŸÑŸäŸàŸÖ ÿ≥Ÿäÿµÿ®ÿ≠ ÿ£ŸÅÿ∂ŸÑ ÿ®ŸÉÿ´Ÿäÿ±!"
    ], 
    anger: [
      "ÿ£ÿ¥ÿπÿ± ÿ£ŸÜŸÉ ŸÖŸÜÿ≤ÿπÿ¨ ÿ®ÿπÿ∂ ÿßŸÑÿ¥Ÿäÿ°. ÿÆÿ∞ ŸÜŸÅÿ≥Ÿãÿß ÿπŸÖŸäŸÇŸãÿß.. ÿßŸÑÿ£ŸÖŸàÿ± ÿ≥ÿ™ÿ™ÿ≠ÿ≥ŸÜ",
      "ÿßŸÑÿ∫ÿ∂ÿ® ÿ∑ÿ®ŸäÿπŸä ÿ£ÿ≠ŸäÿßŸÜŸãÿßÿå ŸÑŸÉŸÜ ÿ™ÿ∞ŸÉÿ± ÿ£ŸÜŸÉ ŸÇÿßÿØÿ± ÿπŸÑŸâ ÿ™ŸáÿØÿ¶ÿ© ŸÜŸÅÿ≥ŸÉ",
      "ÿ£ÿ™ŸÅŸáŸÖ ÿ≥ÿ®ÿ® ÿ∫ÿ∂ÿ®ŸÉÿå Ÿáÿ∞ÿß ÿßŸÑŸÖŸàŸÇŸÅ ÿµÿπÿ® ÿ≠ŸÇÿßŸã",
      "ŸÑÿß ÿ®ÿ£ÿ≥ ÿ£ŸÜ ÿ™ÿ¥ÿπÿ± ÿ®ÿßŸÑÿ∫ÿ∂ÿ®ÿå ŸÑŸÉŸÜ ŸÑÿß ÿ™ÿØÿπŸá Ÿäÿ≥Ÿäÿ∑ÿ± ÿπŸÑŸäŸÉ"
    ], 
    greeting: [
      "ŸÖÿ±ÿ≠ÿ®ÿßŸã! ŸÉŸäŸÅ ÿ≠ÿßŸÑŸÉ ÿßŸÑŸäŸàŸÖÿü",
      "ÿ£ŸáŸÑÿßŸã Ÿàÿ≥ŸáŸÑÿßŸã! ŸÉŸäŸÅ ÿ™ŸÇÿ∂Ÿä ŸäŸàŸÖŸÉÿü",
      "ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ! ŸÉŸäŸÅ ŸäŸÖŸÉŸÜŸÜŸä ŸÖÿ≥ÿßÿπÿØÿ™ŸÉ ÿßŸÑŸäŸàŸÖÔºü"
    ], 
    weather: [
      "ÿßŸÑÿ∑ŸÇÿ≥ ÿ¨ŸÖŸäŸÑ ÿßŸÑŸäŸàŸÖÿå ÿ£ŸÑŸäÿ≥ ŸÉÿ∞ŸÑŸÉÔºü",
      "ÿ£ÿ™ŸÖŸÜŸâ ÿ£ŸÜ ŸäŸÉŸàŸÜ ÿßŸÑÿ¨Ÿà ŸÖÿπÿ™ÿØŸÑÿßŸã ŸÅŸä ŸÖŸÜÿ∑ŸÇÿ™ŸÉ",
      "ÿßŸÑÿ∑ŸÇÿ≥ Ÿäÿ§ÿ´ÿ± ŸÉÿ´Ÿäÿ±ÿßŸã ÿπŸÑŸâ ŸÖÿ≤ÿßÿ¨ŸÜÿßÿå ŸÉŸäŸÅ ÿßŸÑÿ∑ŸÇÿ≥ ÿπŸÜÿØŸÉÔºü"
    ] 
  }, 
  en: { 
    sadness: [
      "I know how you feel when everything around you feels heavy",
      "Sometimes sadness comes suddenly and makes everything seem dull",
      "I understand the loneliness that accompanies sadness",
      "It's okay to feel this way. I'm here with you"
    ], 
    happiness: [
      "I felt such a big joy today! Everything around you seemed bright",
      "You can't imagine how happy I felt when you shared with me",
      "Your joy today was contagious! I didn't expect it to affect me this way"
    ], 
    anger: [
      "I feel you're a bit upset. Take a deep breath.. things will get better",
      "Anger is natural sometimes, but remember you can calm yourself"
    ], 
    greeting: [
      "Hello! How are you today?",
      "Hi there! How's your day going?",
      "Welcome! How can I help you today?"
    ] 
  } 
};

// ====================== ÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿßŸÑŸÖŸÅÿ™ÿßÿ≠Ÿäÿ© ====================== 
const keywords = { 
  ar: { 
    sadness: ['ÿ≠ÿ≤ŸäŸÜ', 'ÿ™ÿπÿ®ÿßŸÜ', 'ÿ∂ÿ∫ÿ∑', 'ŸÖÿ¥ŸÉŸÑÿ©', 'ÿ£ÿ≠ÿ®ÿßÿ∑'], 
    happiness: ['ŸÅÿ±ÿ≠', 'ÿ≥ÿπŸäÿØ', 'ŸÖÿ®ÿ≥Ÿàÿ∑', 'ÿ∂ÿ≠ŸÉ', 'ÿ¨ŸÖŸäŸÑ'], 
    anger: ['ÿ∫ÿßÿ∂ÿ®', 'ŸÖŸÜÿ≤ÿπÿ¨', 'ÿ∫Ÿäÿ∏', 'ÿ∂ŸäŸÇ'], 
    greeting: ['ŸÖÿ±ÿ≠ÿ®ÿß', 'ÿßŸáŸÑÿß', 'ÿßŸÑÿ≥ŸÑÿßŸÖ'], 
    weather: ['ÿ∑ŸÇÿ≥', 'ÿ¨Ÿà', 'ÿ≠ÿ±', 'ÿ®ÿ±ÿØ'] 
  }, 
  en: { 
    sadness: ['sad', 'tired', 'pressure', 'problem'], 
    happiness: ['happy', 'joy', 'excited', 'laugh'], 
    anger: ['angry', 'annoyed', 'frustrated'], 
    greeting: ['hello', 'hi', 'hey'], 
    weather: ['weather', 'sunny', 'rain'] 
  } 
};

// ====================== Placeholders ŸÑŸÑÿ∫ÿßÿ™ ÿßŸÑŸÖÿÆÿ™ŸÑŸÅÿ© ======================
const placeholders = {
  ar: 'ÿßŸÉÿ™ÿ® ÿ±ÿ≥ÿßŸÑÿ™ŸÉ ŸáŸÜÿß...',
  en: 'Type your message here...',
  es: 'Escribe tu mensaje aqu√≠...',
  fr: '√âcrivez votre message ici...',
  hi: '‡§Ö‡§™‡§®‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§Ø‡§π‡§æ‡§Å ‡§≤‡§ø‡§ñ‡•á‡§Ç...',
  tl: 'Type your message here...'
};

let conversationHistory = [];
let currentLanguage = 'ar';
let conversationContext = {
    currentTopic: '',
    userMood: 'neutral',
    mentionedTopics: []
};

function analyzeSentiment(text) {
    const sentimentWords =  {
    // ÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿßŸÑÿ¨ÿØŸäÿØÿ©
    'ŸÅÿ±ÿ≠ÿßŸÜ': 2, 'ŸÖÿ≥ÿ±Ÿàÿ±': 2, 'ÿ≥ÿπŸäÿØÿ©': 2, 'ŸÅÿ±ÿ≠ÿ©': 2,
    'ŸÖÿ≠ÿ®ÿ∑': -2, 'ŸÖÿ™ÿ∂ÿßŸäŸÇ': -1.5, 'ŸÖŸÜÿ≤ÿπÿ¨ÿ©': -1.5, 'ÿ™ÿπÿ®ÿ©': -1.5, 'ŸÖÿ±ŸáŸÇ': -2,
    'ŸÖÿ™ŸÅÿßÿ¶ŸÑ': 1.5, 'ŸÖÿ™ÿ≠ŸÖÿ≥': 1.5, 'ŸÖŸÜÿØŸáÿ¥': 1.2, 'ŸÖŸÖÿ™ŸÜ': 1.5,
    
    // ÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿßŸÑÿ£ÿµŸÑŸäÿ©
    'ÿ≥ÿπŸäÿØ': 2, 'ŸÅÿ±ÿ≠': 2, 'ŸÖÿ®ÿ≥Ÿàÿ∑': 2, 'ÿ±ÿßÿ¶ÿπ': 1.5,
    'ÿ≠ÿ≤ŸäŸÜ': -2, 'ÿ™ÿπŸäÿ≥': -2, 'ÿ≤ÿπŸÑÿßŸÜ': -2, 'ÿ∫ÿßÿ∂ÿ®': -2.5, 'ŸÖŸÜÿ≤ÿπÿ¨': -2,
    'ŸÖÿ¥': -1, 'ŸÑÿß': -1, 'ŸÖŸà': -1, 'ŸÑŸäÿ≥': -1,
    'ÿ¨ÿØÿßŸã': 1.5, 'ÿ¨ÿØÿß': 1.5, 'ŸÉÿ´Ÿäÿ±': 1.3, 'ŸÖÿ±Ÿá': 1.3
};

    let score = 0;
    let words = text.split(' ');
    let modifier = 1;

    words.forEach(word => {
        word = word.toLowerCase().replace(/[.,!?;:]$/, '');
        
        if (sentimentWords[word] !== undefined) {
            if (Math.abs(sentimentWords[word]) === 1) {
                modifier *= sentimentWords[word];
            } else {
                score += sentimentWords[word] * modifier;
                modifier = 1;
            }
        }
    });

    if (score > 1) return 'happiness';
    if (score < -1) return 'sadness';
    if (score < -2) return 'anger';
    return Math.random() > 0.5 ? 'greeting' : 'neutral';
}

function updateConversationContext(text, emotion) {
    const topics = ['ÿπŸÖŸÑ', 'ÿØÿ±ÿßÿ≥ÿ©', 'ÿπÿßÿ¶ŸÑÿ©', 'ÿ£ÿµÿØŸÇÿßÿ°', 'ÿµÿ≠ÿ©'];
    const mentioned = topics.filter(topic => text.includes(topic));
    
    if (mentioned.length > 0) {
        conversationContext.currentTopic = mentioned[0];
        conversationContext.mentionedTopics.push(...mentioned);
    }
    conversationContext.userMood = emotion;
}

function getSmartResponse(emotion, context) {
    const contextualResponses = {
        sadness: {
            work: "ÿ£ÿ™ŸÅŸáŸÖ ÿ∂ÿ∫ÿ∑ ÿßŸÑÿπŸÖŸÑ. ŸáŸÑ ÿ™ÿ±ŸäÿØŸäŸÜ ŸÜÿµŸäÿ≠ÿ© ÿπŸÖŸÑŸäÿ© ŸÑÿ™ÿÆŸÅŸäŸÅ ÿßŸÑÿ™Ÿàÿ™ÿ±ÿü",
            study: "ÿßŸÑÿØÿ±ÿßÿ≥ÿ© ŸÖŸÖŸÉŸÜ ÿ™ŸÉŸàŸÜ ÿµÿπÿ®ÿ© ÿßÿ≠ŸäÿßŸÜÿßŸã. ÿ£Ÿä ŸÖÿßÿØÿ© ÿ™ÿπÿ™ÿ®ÿ±ŸäŸÜŸáÿß ÿßŸÑÿ£ÿµÿπÿ®ÿü",
            general: "ÿ£ÿ≥ŸÖÿπ ÿ≠ÿ≤ŸÜŸÉ ŸÅŸä ÿµŸàÿ™ŸÉ. ÿ™ÿ±ŸäÿØŸäŸÜ ÿ™ÿ™ŸÉŸÑŸÖŸäŸÜ ÿπŸÜ ÿßŸÑÿ¥Ÿäÿ° ÿßŸÑŸÖÿ≤ÿπÿ¨ÿü"
        },
        happiness: {
            work: "ŸàÿßŸà! Ÿäÿ®ÿØŸà ÿ£ŸÜ ÿßŸÑÿπŸÖŸÑ ŸäŸÖÿ¥Ÿä ÿ®ÿ¥ŸÉŸÑ ÿ±ÿßÿ¶ÿπ ÿßŸÑŸäŸàŸÖ! üíº‚ú®",
            study: "ŸÖÿ®ÿ±ŸàŸÉ! ÿ•ŸÜÿ¨ÿßÿ≤ ÿßŸÑÿØÿ±ÿßÿ≥ÿ© ÿ¥ÿπŸàÿ± ŸÑÿß ŸäŸàÿµŸÅ! üéìüî•", 
            general: "ŸÅÿ±ÿ≠ÿ™Ÿä ŸÑŸÅÿ±ÿ≠ŸÉ! ÿßŸäÿ¥ ÿßŸÑÿ¥Ÿäÿ° ÿßŸÑÿ¨ŸÖŸäŸÑ ÿßŸÑŸÑŸä ÿµÿßÿ±ÿü üåà"
        },
        anger: {
            work: "ÿßŸÑÿ¥ÿ∫ŸÑ ÿ£ÿ≠ŸäÿßŸÜÿßŸã Ÿäÿ≤ÿπŸÑ. ÿßŸäÿ¥ ÿßŸÑŸÑŸä ŸÖÿ≤ÿπÿ¨ŸÉ ÿ®ÿßŸÑÿ∂ÿ®ÿ∑ÿü",
            study: "ÿßŸÑÿØÿ±ÿßÿ≥ÿ© ŸÖŸÖŸÉŸÜ ÿ™ÿ≥ÿ®ÿ® ÿπÿµÿ®Ÿäÿ©. ÿßŸäÿ¥ ÿßŸÑŸÖÿßÿØÿ© ÿßŸÑŸÑŸä ÿ™ÿ≤ÿπŸÑŸÉÿü",
            general: "ÿ£ÿ≥ŸÖÿπ ÿ∫ÿ∂ÿ®ŸÉ. ÿ™ÿ±ŸäÿØŸäŸÜ ÿ™ÿ™ŸÉŸÑŸÖŸäŸÜ ÿπŸÜ ÿßŸÑŸÑŸä ÿµÿßÿ±ÿü"
        },
        greeting: {
            general: "ÿ£ŸáŸÑÿßŸã Ÿàÿ≥ŸáŸÑÿßŸã! ŸÉŸäŸÅ ŸäŸÖŸÉŸÜŸÜŸä ŸÖÿ≥ÿßÿπÿØÿ™ŸÉ ÿßŸÑŸäŸàŸÖÔºü ü§ó"
        },
        weather: {
            general: "ÿßŸÑÿ∑ŸÇÿ≥ ÿ¨ŸÖŸäŸÑ ÿßŸÑŸäŸàŸÖÿå ÿ£ŸÑŸäÿ≥ ŸÉÿ∞ŸÑŸÉÔºü ‚òÄÔ∏è"
        }
    };

    
    
    return contextualResponses[emotion]?.[context.currentTopic] 
        || contextualResponses[emotion]?.general
        || responses[currentLanguage][emotion]?.[0]
        || responses[currentLanguage]['greeting'][0];
}

function detectEmotion(text, language) {
    if (!responses[language]) language = 'en';
    
    const textLower = text.toLowerCase();
    let detectedEmotion = null;
    let maxMatches = 0;

    for (const [emotion, words] of Object.entries(keywords[language])) {
        let matches = 0;
        for (const word of words) {
            if (textLower.includes(word)) matches++;
        }
        if (matches > maxMatches) {
            maxMatches = matches;
            detectedEmotion = emotion;
        }
    }

    if (!detectedEmotion) {
        const emotions = Object.keys(responses[language]);
        detectedEmotion = emotions[Math.floor(Math.random() * emotions.length)];
    }

    return detectedEmotion;
}

function updatePlaceholder() {
    const inputField = document.getElementById('user-input');
    inputField.placeholder = placeholders[currentLanguage] || placeholders['en'];
}

function sendMessage() {
    const userInput = document.getElementById('user-input').value.trim();
    
    if (!userInput) return;
    
    conversationHistory.push(userInput);
    if (conversationHistory.length > 5) conversationHistory.shift();

    const chatContainer = document.getElementById('chat-container');
    const userMsg = document.createElement('div');
    userMsg.className = 'message user-message';
    userMsg.textContent = userInput;
    chatContainer.appendChild(userMsg);

    document.getElementById('user-input').value = '';
    chatContainer.scrollTop = chatContainer.scrollHeight;

    const typingIndicator = document.getElementById('typing-indicator');
    typingIndicator.style.display = 'flex';
    chatContainer.scrollTop = chatContainer.scrollHeight;

    const typingTime = Math.min(3000, Math.max(1000, userInput.length * 50));

    setTimeout(() => {
        typingIndicator.style.display = 'none';
        
        const contextText = conversationHistory.join(' ');
        const emotion = analyzeSentiment(contextText);
        updateConversationContext(userInput, emotion);
        const smartResponse = getSmartResponse(emotion, conversationContext);
        
        const botMsg = document.createElement('div');
        botMsg.className = 'message bot-message';
        botMsg.textContent = smartResponse;

        const feedbackDiv = document.createElement('div');
        feedbackDiv.className = 'feedback-buttons';
        
        feedbackDiv.innerHTML = `
            <button class="feedback-btn" data-response="${encodeURIComponent(smartResponse)}" data-rating="good">üëç</button>
            <button class="feedback-btn" data-response="${encodeURIComponent(smartResponse)}" data-rating="bad">üëé</button>
        `;
        
        feedbackDiv.querySelectorAll('.feedback-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const response = decodeURIComponent(this.getAttribute('data-response'));
                const rating = this.getAttribute('data-rating');
                rateResponse(response, rating);
            });
        });

        botMsg.appendChild(feedbackDiv);
        chatContainer.appendChild(botMsg);
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }, typingTime);
}

function rateResponse(responseText, rating) {
    const contextData = {
        userInput: conversationHistory[conversationHistory.length - 1],
        emotion: conversationContext.userMood,
        topic: conversationContext.currentTopic
    };
    
    let ratings = JSON.parse(localStorage.getItem('responseRatings') || '{}');
    ratings[responseText] = {
        rating: rating,
        context: contextData,
        timestamp: Date.now()
    };
    localStorage.setItem('responseRatings', JSON.stringify(ratings));
    
    const thankYouMessages = {
        ar: 'ÿ¥ŸÉÿ±Ÿãÿß ŸÑŸÑÿ™ŸÇŸäŸäŸÖ! ÿ≥ÿ™ÿ™ÿ≠ÿ≥ŸÜ ÿ±ÿØŸàÿØŸä ÿ®ŸÜÿßÿ°Ÿã ÿπŸÑŸâ ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ŸÉ.',
        en: 'Thank you for your feedback! I will improve my responses based on your input.',
        es: '¬°Gracias por tu comentario! Mejorar√© mis respuestas bas√°ndome en tu opini√≥n.',
        fr: 'Merci pour votre commentaire ! J\'am√©liorerai mes r√©ponses en fonction de votre avis.',
        hi: '‡§Ü‡§™‡§ï‡•á ‡§´‡•Ä‡§°‡§¨‡•à‡§ï ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶! ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•á ‡§á‡§®‡§™‡•Å‡§ü ‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞ ‡§Ö‡§™‡§®‡•Ä ‡§™‡•ç‡§∞‡§§‡§ø‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§ì‡§Ç ‡§Æ‡•á‡§Ç ‡§∏‡•Å‡§ß‡§æ‡§∞ ‡§ï‡§∞‡•Ç‡§Ç‡§ó‡§æ‡•§',
        tl: 'Salamat sa iyong feedback! Pagbutihin ko ang aking mga tugon batay sa iyong input.'
    };
    
    alert(thankYouMessages[currentLanguage] || thankYouMessages['en']);
}

document.addEventListener('DOMContentLoaded', function() {
    const button = document.getElementById('send-btn');
    const lottieContainer = document.getElementById('lottie-bg');

    function changeBackground() {
        lottie.loadAnimation({
            container: lottieContainer,
            renderer: 'svg',
            loop: true,
            autoplay: true,
            path: 'Background Full Screen-Night.json'
        });
    }

    button.addEventListener('click', changeBackground, { once: true });
    document.getElementById('send-btn').addEventListener('click', sendMessage);

    document.getElementById('user-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') sendMessage();
    });

    document.querySelectorAll('.lang-btn').forEach(button => {
        button.addEventListener('click', function() {
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
            currentLanguage = this.getAttribute('data-lang');
            updatePlaceholder();
        });
    });
    
    updatePlaceholder();
});
